<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Crear Comprobante</title>
</head>
<body>

<h1>Crear Comprobante</h1>

<label>Mes:</label>
<input type="month" id="mesSeleccionado">

<br><br>

<div id="calendario"></div>

<br>

<form id="formTurnos"
      th:action="@{'/empresas/' + ${empresaId} + '/comprobantes/guardar'}"
      method="post">

    <input type="hidden" name="mes" id="mesHidden">
    <input type="hidden" name="anio" id="anioHidden">

    <div id="turnosContainer"></div>

    <br>
    <button type="submit">Guardar comprobante</button>
</form>

<script>
document.getElementById("mesSeleccionado").addEventListener("change", function() {
    const valor = this.value; // formato YYYY-MM
    if (!valor) return;

    const [anio, mes] = valor.split("-");
    document.getElementById("mesHidden").value = mes;
    document.getElementById("anioHidden").value = anio;

    generarCalendario(anio, mes);
});

function generarCalendario(anio, mes) {
    const calendario = document.getElementById("calendario");
    calendario.innerHTML = "";

    const dias = new Date(anio, mes, 0).getDate();

    for (let i = 1; i <= dias; i++) {
        const boton = document.createElement("button");
        boton.type = "button";
        boton.innerText = i;

        boton.onclick = function() {
            agregarTurno(anio, mes, i);
        };

        calendario.appendChild(boton);
    }
}

function agregarTurno(anio, mes, dia) {
    const container = document.getElementById("turnosContainer");

    const div = document.createElement("div");

    div.innerHTML =
        "DÃ­a " + dia +
        " <input type='hidden' name='fechas' value='" + anio + "-" + mes + "-" + dia + "'>" +
        " Monto: <input type='number' step='0.01' name='montos'>";

    container.appendChild(div);
}

</script>
<label>Trabajador:</label>
<select name="trabajadorId" required>
    <option value="">Seleccione</option>
    <option th:each="t : ${trabajadores}"
            th:value="${t.id}"
            th:text="${t.nombre}">
    </option>
</select>

<br><br>
</body>
</html>